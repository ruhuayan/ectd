
<!-- BEGIN PAGE HEADER-->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a ui-sref="dashboard" translate><span class="title" translate>HOME</span></a>
            <i class="fa fa-circle"></i>
        </li>
        <li>
            <a ui-sref="submission"><span class="title" translate>SUBMISSION</span></a>
        </li>
    </ul>
    <div class="page-toolbar">
        <div class="btn-group pull-right">
            <button type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" dropdown-menu-hover data-delay="1000" data-close-others="true"> Actions
                <i class="fa fa-angle-down"></i>
            </button>
            <ul class="dropdown-menu pull-right" role="menu">
                <li>
                    <a href="#">
                        <i class="icon-user"></i> New User </a>
                </li>
                <li>
                    <a href="#">
                        <i class="icon-present"></i> New Event
                        <span class="badge badge-success">4</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="icon-basket"></i> New order </a>
                </li>
                <li class="divider"> </li>
                <li>
                    <a href="#">
                        <i class="icon-flag"></i> Pending Orders
                        <span class="badge badge-danger">4</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="icon-users"></i> Pending Users
                        <span class="badge badge-warning">12</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
<h3 class="page-title"><span class="title" translate>NEWSUB</span></h3>

<div class="row" ng-controller="SubmissionCtrl">
    <div class="col-md-6">
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption font-green-sharp">
                    <i class="icon-settings font-green-sharp"></i>
                    <span class="caption-subject bold uppercase"><span class="title" translate>CREATENEW</span></span>
                    <span class="caption-helper"><span class="title" translate>PLANNEDSUB</span></span>
                </div>
                <div class="actions">
                    
                    <a class="btn btn-circle btn-icon-only btn-default" ng-click="toggleEditable()">
                        <span class="glyphicon glyphicon-pencil" ng-show="uneditable" title="Editable"></span>
                        <span class="glyphicon glyphicon-ban-circle" ng-hide="uneditable" title="Uneditable" style="color: red;"></span>
                    </a>
                    <a class="btn btn-circle btn-icon-only btn-default" ng-click="exitApp()" title="Exit">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body" >
                <form class="form-horizontal" role="form" ng-submit="createApp();" name="subForm" ng-init="formData.version='0000'; isVersionNum=true;">
                    <div class="form-body">
                        <div class="form-group first">
                            <label class="col-sm-3 bold">eCTD Template:</label>
                            <div class="col-sm-9">
                                <select class="selectpicker" style="width: 100%;height:35px;">
                                    <option>US: eCTD v3.2 US v3.3</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group bg-primary text-white"><label class="col-sm-3"><span class="panel-title bold" translate>DOCUMENT</span> </label></div>
                              
                        <div class="form-group row" ng-class="{ 'has-error' : subForm.description.$invalid && subForm.description.$touched }">
                            <label for="description" class="col-sm-3"><span class="form-label bold" translate>DESCRIPTION</span></label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="description" id="description" ng-model="formData.description" placeholder="Enter Description" ng-disabled="uneditable" required />
                                <p ng-show=" subForm.description.$touched && subForm.description.$invalid" class="help-block">Description is required.</p>
                            </div>
                        </div>
                        <div class="form-group" ng-class="{ 'has-error' : subForm.folder.$invalid && subForm.folder.$touched }">
                            <label for="folder" class="col-sm-3"><span class="form-label bold" translate>APPFOLDER</span> </label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="folder" id="folder" ng-model="formData.folder" placeholder="Enter Application Folder" ng-disabled="uneditable" required />
                                <p ng-show=" subForm.folder.$touched && subForm.folder.$invalid" class="help-block">Application Folder is required.</p>
                            </div>
                        </div>
                            
                        <div class="form-group bg-primary text-white"><label class="col-sm-3"><span class="panel-title bold" translate>VERSION</span> </label></div>
                    
                                 
                        <div class="form-group row" ng-class="{ 'has-error' : subForm.version.$invalid && subForm.version.$touched || !isVersionNum}">
                            <label for="version" class="col-sm-3"><span class="form-label bold" translate>VERSION</span></label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control input-sm" name="version" id="version" ng-model="formData.version" 
                                       minlength="4" maxlength="4" ng-change="isVersionNum = isStringNumberic(subForm.version.$viewValue)" ng-disabled="uneditable" required />
                                <p ng-show="subForm.version.$touched && subForm.version.$error.required" class="help-block">Version is required.</p>
                                <p ng-show="((subForm.version.$error.minlength ||subForm.version.$error.maxlength) || !isVersionNum)" class="help-block">Version should be 4 digits.</p>
                            </div>
                        </div>
                                <div class="form-group">
                                    <label for="sequence" class="col-sm-3"><span class="form-label" translate>SEQUENCE</span><span class="form-label" translate>DESCRIPTION</span></label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" name="sequence" id="sequence" ng-model="formData.sequence" placeholder="Sequence Description" ng-disabled="uneditable" />
                                        
                                    </div>
                                </div>
                            
                        <div class="form-group bg-primary text-white"><label class="col-sm-3"><span class="panel-title bold" translate>OBJECT</span> </label></div> 
                      
                        <div class="form-group" >
                            <label class="col-sm-3" for="compilation"><span class="form-label" translate>COMPILATION</span> </label>
                            <div class="col-sm-9">
                                 <input class="form-check-input" type="checkbox" name="compilation" id="compilation" ng-model="formData.compilation" ng-disabled="uneditable" />
                            </div>
                        </div>
                        <div class="form-group"  >
                            <label class="col-sm-3" for="regulatory"><span class="form-label" translate>REG_ACT</span> </label>
                            <div class="col-sm-9">
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input  type="checkbox" name="regulatory" id="regulatory" ng-model="formData.regulatory" ng-disabled="uneditable" /> 
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3"><span class="form-label" translate>REG_ACT_ID</span></label>
                            <div class="col-sm-6">
                                <select class="form-control"  disabled>
                                    <option>European Union</option>
                                    <option>Japan</option> <option selected></option>
                                </select>
                            </div>
                        </div>
                       
                        <div class="form-actions">
                            <div class="row">
                                <div class="col-md-offset-2 col-md-10">
                                    <button type="submit" class="btn green" ng-disabled="subForm.$invalid"><span class="title" translate>{{submitLabel}}</span></button>
                                    <button type="button" class="btn default" ng-click="cancelApp()"><span class="title" translate>CANCEL</span></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
        </div>
    </div>
     <div class="col-md-6">
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption font-green-sharp">
                    <i class="icon-settings font-green-sharp"></i>
                    <span class="caption-subject bold uppercase"><span class="title" translate>SUBMISSION</span></span>
                    <span class="caption-helper">(submission list)</span>
                </div>
              
            </div>
            <div class="portlet-body portlet-submitted" ></div>
        </div>
     </div>
</div>
<!-- END MAIN CONTENT -->
<!-- BEGIN MAIN JS-->
<script>
    
    function SubmissionCtrl($rootScope, $scope, $state, $cookies){
        
        var appData = $cookies.get("appData")? JSON.parse($cookies.get("appData")):null;
        var appID;
        if(appData){       
            appID = appData.appID;                                              //console.log(appData);
            $scope.submitLabel = "Edit Application";
            $scope.formData = angular.copy(appData);
            $scope.formData.action = "save";
            $scope.formData.appID = appID;
            $scope.uneditable = true;
        }else{
            $scope.submitLabel = "Create Application"; 
            $scope.formData={"version": "0000"};
            $scope.formData.action = "create"; 
            $scope.formData.userID = JSON.parse($cookies.get("globals")).id;
            $scope.uneditable = false;
        }
        
        $scope.toggleEditable = function(){
            $scope.uneditable =!$scope.uneditable;
        };
        
        $scope.createApp = function(){
            if($scope.subForm.$valid){
                var jsonData = JSON.stringify($scope.formData);                 //$rootScope.appData = jsonData;
                $.post('php/submission.php', {'appData': jsonData}, function(res){
                    if(res) {
                        var result = JSON.parse(res);
                        if(appID) toastr.success('Save application ID: '+ appID);
                        else toastr.success("Create application ID: "+ result.appID);
                       
                        var cookieExp = new Date();
                        cookieExp.setDate(cookieExp.getDate() + 1);
                        $cookies.putObject('appData', result, { expires: cookieExp});                                                     
                        $state.go("fileupload").then(function() {   });
                        //$('.portlet-submitted').html(res);
                    }
                });   
          }   
        };
        $scope.cancelApp = function(){ 
             $scope.formData= appData? angular.copy(appData): {"version": "0000"};
             $scope.subForm.$setPristine();
             $scope.subForm.$setValidity();
             $scope.subForm.$setUntouched();
        };
         $scope.isStringNumberic = function(s){
            var x = + s;                                         //console.log('x', x.toString() === s);
            return x === parseInt(s);
        };
        $scope.exitApp = function(){
            $cookies.remove("appData");
            $state.go("dashboard").then(function() {   });
        };
    }
</script>
<!-- BEGIN MAIN JS -->