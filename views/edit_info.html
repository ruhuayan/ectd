<style>
.form-panels .panel-primary>.panel-heading a:after {
  content: "";
  position: relative;
  top: 1px;
  display: inline-block;
  font-family: 'Glyphicons Halflings';
  font-style: normal;
  font-weight: 400;
  line-height: 1;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  float: right;
  transition: transform .25s linear;
  -webkit-transition: -webkit-transform .25s linear;
}
.form-panels .panel-primary>.panel-heading a[aria-expanded="true"]:after {
  content: "\2212";
  -webkit-transform: rotate(180deg);
  transform: rotate(180deg);
}

.form-panels .panel-primary>.panel-heading a[aria-expanded="false"]:after {
  content: "\002b";
  -webkit-transform: rotate(90deg);
  transform: rotate(90deg);
}
.form-panels .input-ssm{height:20px;} 
.form-panels .panel-primary{border: 0;}

.form-panels .panel-heading{padding: 3px 1em 3px 1em;}
.form-panels textarea{resize: none;}
</style>
<!-- BEGIN PAGE HEADER-->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a ui-sref="dashboard"><span class="title" translate>HOME</span></a>
            <i class="fa fa-circle"></i>
        </li>
        <li>
            <a><span class="title" translate>EDITINFO</span></a>
        </li>
    </ul> 
</div>
<!-- <h3 class="page-title"> Edit File</h3>
END PAGE HEADER-->
<!-- BEGIN MAIN CONTENT -->
<!--<div class="note note-success">
    <h3>
        <span class="label label-danger">Edit Admin info and STF</span>
    </h3>
</div>-->
<div class="row">
    <div class="leftPanel col-md-4"> 
        <div class="portlet light bordered jstree-portlet" ng-controller="JstreeCtrl">
            <div class="portlet-title">
                <div class="caption font-green-sharp">
                    <!--<i class="icon-settings font-green-sharp"></i>-->
                    <span class="caption-subject bold uppercase">Application</span>
                    <a class="btn-circle" ng-click="toggleTree()">
                        <i class="fa fa-caret-up" title="close file tree" ng-show="open"></i>
                        <i class="fa fa-caret-down" title="open file tree" ng-hide="open"></i>
                    </a>
                </div>
                <div class="actions">
                    <a class="btn btn-sm green" ng-click="togglePortlet()" ng-hide="tagEdit"><span class="title" translate>EDITTAG</span></a>
                    <a class="btn btn-square btn-default btn-sm" href="javascript:togglePanel();">
                        <i class="fa fa-exchange" aria-hidden="true"></i></a>    
                </div>
            </div>
            <div class="portlet-body"><div id="jsECTDtree" class="scroller"> </div>
            </div>
        </div>
       
    </div>
    <div class="rightPanel col-md-8">
        <!-- BEGIN: ACCORDION DEMO -->
        <div class="portlet light bordered admin-portlet" id="AdinfoCtrl" ng-controller="AdinfoCtrl" ng-init="uneditable = true" ng-hide="tagEdit">
            <div class="portlet-title">
                <div class="caption font-green-sharp">
                    <i class="icon-settings font-green-sharp"></i>
                    <span class="caption-subject bold uppercase"><span class="title" translate>ADMINISTRATION</span></span>  
                </div>
                
                <div class="actions">
                    <a class="btn btn-circle btn-icon-only btn-default" ng-click="toggleEditable()">
                        <span class="glyphicon glyphicon-pencil" ng-show="uneditable" title="Editable"></span>
                        <span class="glyphicon glyphicon-ban-circle" ng-hide="uneditable" title="Uneditable" style="color: red;"></span>
                    </a>
                    <!--<a class="btn btn-circle btn-icon-only btn-default" title="Save" ng-click="submitAdinfo()">
                        <span class="glyphicon glyphicon-save-file"></span>
                    </a>-->
                    <a class="btn btn-circle btn-icon-only btn-default" title="Close" ng-click="togglePortlet()">
                         <span class="glyphicon glyphicon-remove"></span>
                    </a>
                </div>
            </div>
            <div class="portlet-body panel-group form-panels" id="accordion" role="tablist" aria-multiselectable="true">
                    <div class="panel panel-primary">
                        <div class="panel-heading" role="tab" id="headingOne">
                            <a class="panel-title" onclick="Portlet.togglePanel(this, 0);" data-toggle="collapse" data-parent="#accordion" aria-expanded="true" aria-controls="collapseOne">
                                <span class="title" translate>USA</span></a>
                        </div>
                        <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                          <div class="panel-body" >

                            <form class="form-horizontal" role="form" ng-submit="submitAdinfo();" name="adminForm">
                                <div class="form-body">         

                                    <div class="form-group first" ng-class="{'has-error' : adminForm.dunsNumber.$touched && adminForm.dunsNumber.$invalid }">
                                        <label for="dunsNumber" class="col-sm-3"><span class="form-label bold" translate>APPLICATION</span>&nbsp;<span class="bold"> ID(D-U-N-SO)</span><span class="required">*</span></label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control input-sm" name="dunsNumber" id="dunsNumber" ng-model="adminData.dunsNumber" placeholder="000000000"
                                                maxlength="9" required ng-disabled="uneditable" numberic-check="9">
                                            <p ng-show="adminForm.dunsNumber.$touched && adminForm.dunsNumber.$error.required" class="help-block">Application ID is required.</p>
                                            <p ng-show="adminForm.dunsNumber.$error.numberic" class="help-block">Application ID should be 9 digits.</p>
                                        </div>
                                    </div>
                                    <div class="form-group" ng-class="{ 'has-error' : adminForm.companyName.$invalid && adminForm.companyName.$touched }">
                                        <label for="companyName" class="col-sm-3"><span class="form-label bold" translate>COMPANYNAME</span> <span class="required">*</span></label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control input-sm" name="companyName" id="companyName" ng-model="adminData.companyName" placeholder="Enter Company Name" required ng-disabled="uneditable">
                                            <p ng-show=" adminForm.companyName.$touched && adminForm.companyName.$invalid" class="help-block">Company Name is required.</p>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="description" class="col-sm-3">
                                            <span class="form-label" translate>SUBMISSION</span>&nbsp;<span class="form-label" translate>DESCRIPTION</span>
                                        </label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control input-sm" name="description" id="description" ng-model="adminData.description" maxlength="128"
                                                   placeholder="Enter Submission Description" ng-disabled="uneditable">
                                            <p ng-show="(adminForm.description.$error.maxlength)" class="help-block">Maximum length 128 digits.</p>
                                        </div>
                                    </div>

                                    <div class="form-group" ng-class="{ 'has-error' : adminForm.appNumber.$invalid && adminForm.appNumber.$touched }">
                                        <label for="appNumber" class="col-sm-3"><span class="form-label bold" translate>APPLICATION</span> &nbsp;<span class="form-label bold" translate>NUMBER</span><span class="required">*</span></label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control input-sm" name="appNumber" id="appNumber" ng-model="adminData.appNumber" placeholder="Application Number" 
                                                   ng-disabled="uneditable" required numberic-check />
                                            <p ng-show="adminForm.appNumber.$touched && adminForm.appNumber.$error.required" class="help-block">Application Number is required.</p>
                                            <p ng-show="adminForm.appNumber.$error.numberic" class="help-block">Application Number should consist only digits.</p>
                                        </div>
                                    </div>

                                    <div class="form-group"  ng-class="{ 'has-error' : adminForm.appType.$invalid && adminForm.appType.$touched }">
                                        <label for="appType" class="col-sm-3"><span class="form-label bold" translate>APPLICATION</span> &nbsp;<span class="form-label bold" translate>TYPE</span><span class="required">*</span>
                                        </label>
                                        <div class="col-sm-9">
                                            <select class="form-control input-sm" name="appType" id="appType" ng-model="adminData.appType" required ng-disabled="uneditable">
                                                <option  ng-repeat="x in appTypes" ng-selected="adminData.appType.substr(0,3)==x.substr(0,3)">{{x}}</option>
                                            </select>
                                            <p ng-show=" adminForm.appType.$touched && adminForm.appType.$invalid" class="help-block">Application Type is required.</p>
                                        </div>
                                    </div>


                                    <div class="form-group row" ng-class="{ 'has-error' : adminForm.subId.$invalid && adminForm.subId.$touched }">
                                        <label for="subId" class="col-sm-3"><span class="form-label bold" translate>SUBMISSION</span>&nbsp; <span class="bold">ID </span> <span class="required">*</span></label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control input-sm" name="subId" id="subId" ng-model="adminData.subId" placeholder="0000" 
                                           maxlength="4" ng-disabled="uneditable" ng-required="true" numberic-check="4" />
                                    <p ng-show=" adminForm.subId.$touched && adminForm.subId.$error.required" class="help-block">Submission ID is required.</p>
                                    <p ng-show="adminForm.subId.$error.numberic" class="help-block">Submission ID should be 4 digits.</p>
                                </div>
                            </div>
                                    <div class="form-group" ng-class="{ 'has-error' : adminForm.subType.$invalid && adminForm.subType.$touched }">
                                <label for="subType" class="col-sm-3"><span class="form-label bold" translate>SUBMISSION</span> &nbsp;<span class="form-label bold" translate>TYPE</span><span class="required">*</span>
                                </label>
                                <div class="col-sm-9">
                                    <select class="form-control input-sm" name="subType" id="subType" ng-model="adminData.subType" ng-required="true" ng-disabled="uneditable">
                                                <option  ng-repeat="x in subTypes">{{x}}</option>
                                    </select>
                                    <p ng-show=" adminForm.subType.$touched && adminForm.subType.$invalid" class="help-block">Submission Type is required.</p>
                                </div>
                            </div>  
                                    <div class="form-group">
                                        <label for="effType" class="col-sm-3"><span class="form-label" translate>SUP_EFF</span></label>
                                <div class="col-sm-9">
                                    <select class="form-control input-sm" name="effType" id="effType" ng-model="adminData.effType" ng-disabled="uneditable">
                                        <option>None</option>
                                        <option  ng-repeat="x in effTypes">{{x}}</option>
                                    </select>
                                    <!--<p ng-show=" adminForm.effType.$touched && adminForm.effType.$invalid" class="help-block">Submission Type is required.</p>-->
                                </div>
                            </div>

                                    <div class="form-group row" ng-class="{'has-error': adminForm.subnum.$touched && adminForm.subnum.$invalid}">
                                        <label for="subnum" class="col-sm-3"><span class="form-label bold" translate>SUBMISSION</span> &nbsp;<span class="form-label bold" translate>NUMBER</span><span class="required">*</span>
                                        </label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control input-sm" name="subnum" id="subnum" ng-model="adminData.subnum" placeholder="0000" 
                                                maxlength="4" ng-disabled="uneditable" ng-required="true" numberic-check="4" />
                                            <p ng-show=" adminForm.subnum.$touched && adminForm.subnum.$error.required" class="help-block">Submission ID is required.</p>
                                            <p ng-show="adminForm.subnum.$error.numberic" class="help-block">Submission Number should be 4 digits.</p>
                                        </div>
                                    </div>
                                    <div class="form-group" ng-class="{ 'has-error' : adminForm.subSubType.$invalid && adminForm.subSubType.$touched }">
                                <label for="subSubType" class="col-sm-3"><span class="form-label bold" translate>SUBMISSION</span> &nbsp;<span class="form-label bold" translate>SUBTYPE</span><span class="required">*</span> 
                                </label>
                                <div class="col-sm-9">
                                    <select class="form-control input-sm" name="subSubType" id="subSubType" ng-model="adminData.subSubType" ng-disabled="uneditable" required>
                                        <option  ng-repeat="x in subSubTypes">{{x}}</option>
                                    </select>
                                    <p ng-show="adminForm.subSubType.$touched && adminForm.subSubType.$invalid" class="help-block">Submission Sub Type is required.</p>
                                </div>
                            </div>
                                    <div class="form-actions">
                                <div class="row">
                                    <div class="col-md-offset-2 col-md-10">
                                        <button type="submit" class="btn green" ng-disabled="adminForm.$invalid || uneditable"><span class="title" translate>SAVE</span></button>
                                        <button type="button" class="btn default" ng-disabled="uneditable" ng-click="cancelAdinfo()"><span class="title" translate>CANCEL</span></button>
                                    </div>
                                </div>
                            </div>
                                </div>
                            </form>
                          </div>
                        </div>
                    </div>
                    <div class="panel panel-primary">
                        <div class="panel-heading" role="tab" id="headingTwo">
                            <a class="panel-title" onclick="Portlet.togglePanel(this, 1);" data-toggle="collapse" data-parent="#accordion" aria-expanded="false" aria-controls="collapseTwo">
                                <span class="title" translate>APP_CONTACT</span></a>
                        </div>
                        <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                          <div class="panel-body">

                            <form class="form-horizontal" role="form" ng-submit="submitContact();" name="contactForm">
                                <div class="form-body">    

                                    <div class="form-group first"  ng-class="{ 'has-error' : contactForm.contactType.$invalid && contactForm.contactType.$touched }">
                                        <label for="contactType" class="col-sm-3"><span class="form-label" translate>CONT_TYPE</span><span class="required">*</span> </label>
                                        <div class="col-sm-9">
                                            <select class="form-control  input-sm" name="contactType" id="contactType" ng-change="updateContact()" ng-model="contactData.contactType" required ng-disabled="uneditable">
                                                <option  ng-repeat="x in contactTypes">{{x}}</option>
                                            </select>
                                            <p ng-show=" contactForm.contactType.$touched && contactForm.contactType.$invalid" class="help-block">Contact Type is required.</p>
                                        </div>
                                    </div>
                                    <div class="form-group" ng-class="{ 'has-error' : contactForm.contactName.$invalid && contactForm.contactName.$touched }">
                                        <label for="contactName" class="col-sm-3"><span class="form-label" translate>CONT_NAME</span><span class="required">*</span> </label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control input-sm" name="contactName" id="contactName" ng-model="contactData.contactName" placeholder="Contact Name" required ng-disabled="uneditable">
                                            <p ng-show="contactForm.contactName.$touched && contactForm.contactName.$invalid" class="help-block">Contact Name is required.</p>
                                        </div>
                                    </div>
                                    <div class="form-group" ng-class="{'has-error' : contactForm.phone.$touched && contactForm.phone.$invalid}">
                                        <label for="phone" class="col-sm-3"><span class="form-label" translate>TELEPHONE</span><span class="required">*</span></label>
                                        <div class="col-sm-9">
                                            <input type="tel" class="form-control input-sm" name="phone" id="phone" ng-model="contactData.phone" placeholder="514-000-0000" maxlength="10"
                                                   ng-required="true" ng-disabled="uneditable" numberic-check="10" />
                                            <!--<p>{{formData.phone | phonenumber}}</p>-->
                                            <p ng-show="contactForm.phone.$touched && contactForm.phone.$error.required" class="help-block">Telephone Number is required.</p>
                                            <p ng-show="contactForm.phone.$error.numberic" class="help-block">Telephone should be 10 digits.</p>
                                        </div>
                                    </div>
                                    <div class="form-group" ng-class="{ 'has-error' : contactForm.email.$invalid && contactForm.email.$touched }">
                                        <label for="email" class="col-sm-3"><span class="form-label" translate>EMAIL</span> <span class="required">*</span></label>
                                        <div class="col-sm-9">
                                            <input type="email" class="form-control input-sm" name="email" id="email" ng-model="contactData.email" placeholder="sample@ectd.com" required ng-disabled="uneditable">
                                            <p ng-show="contactForm.email.$touched && contactForm.email.$invalid" class="help-block">Email is invalid.</p>
                                        </div>
                                    </div>

                                    <div class="form-actions">
                                        <div class="row">
                                            <div class="col-md-offset-2 col-md-10">
                                                <button type="submit" class="btn green" ng-disabled="contactForm.$invalid || uneditable"><span class="title" translate>SAVE</span></button>
                                                <button type="button" class="btn default" ng-disabled="uneditable" ng-click="cancelContact()"><span class="title" translate>CANCEL</span></button>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </form>
                        </div>
                        </div>
                    </div>
                    <div class="panel panel-primary">
                        <div class="panel-heading" role="tab" id="headingThree">
                            <a class="panel-title" onclick="Portlet.togglePanel(this, 2);" data-toggle="collapse" data-parent="#accordion" aria-expanded="false" aria-controls="collapseThree">
                                <span class="title" translate>CROSS_REF</span></a>
                        </div>
                        <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                          <div class="panel-body">
                            <form class="form-horizontal" role="form" ng-submit="submitReference();" name="referenceForm">
                                <div class="form-body">    
                                    <div class="form-group">
                                        <label class="col-sm-3"><span class="form-label" translate>APPLICATION</span>&nbsp;<span class="form-label" translate>CROSS_REF</span>
                                        </label>
                                        <div class="col-sm-9">
                                            <label><input type="radio" ng-model="referenceData.reference" ng-value="true" ng-checked="referenceData.reference" ng-disabled="uneditable">
                                                &nbsp;<span class="title" translate>YES</span></label> &nbsp;&nbsp;
                                            <label><input type="radio" ng-model="referenceData.reference" ng-value="false" ng-checked="!referenceData.reference" ng-disabled="uneditable">
                                                &nbsp;<span class="title" translate>NO</span></label>
                                            <div ng-class="{'has-error' : referenceForm.refAppNum.$invalid && referenceForm.refAppNum.$touched }" ng-show="referenceData.reference">
                                                <label for="refAppNum" ><span class="form-label">Referenced Application Number: </span>&nbsp; &nbsp;</label>
                                                <input type="text"  name="refAppNum" id="refAppNum" ng-model="referenceData.refAppNum" placeholder="0000000" ng-disabled="uneditable">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group"  ng-class="{ 'has-error' : referenceForm.refAppType.$invalid && referenceForm.refAppType.$touched }" ng-show="referenceData.reference">
                                        <label for="refAppType" class="col-sm-3"><span class="form-label">Referenced Application Type</span> </label>
                                        <div class="col-sm-9">
                                            <select class="form-control" name="refAppType" id="refAppType" ng-model="referenceData.refAppType" required ng-disabled="uneditable">
                                                <option  ng-repeat="x in appTypes">{{x}}</option>
                                            </select>
                                            <p ng-show=" referenceForm.refAppType.$touched && referenceForm.refAppType.$invalid" class="help-block">Referenced Application Type is required.</p>
                                        </div>
                                     </div>


                                    <div class="form-actions">
                                        <div class="row">
                                            <div class="col-md-offset-2 col-md-10">
                                                <button type="submit" class="btn green" ng-disabled="referenceForm.$invalid || uneditable"><span class="title" translate>SAVE</span></button>
                                                <button type="button" class="btn default" ng-disabled="uneditable" ng-click="cancelReference()"><span class="title" translate>CANCEL</span></button>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </form>
                          </div>

                        </div>
                    </div>
                </div>
            
        </div>
        <div class="portlet light bordered tag-portlet" id="TagCtrl" style="width: 60%;" ng-show="tagEdit" ng-controller="TagCtrl" ng-init="init();">
            <div class="portlet-title">
                <div class="caption font-green-sharp">
                    <i class="icon-settings font-green-sharp"></i>
                    <span class="caption-subject bold uppercase">Property</span>
                    
                </div>
                <div class="actions">
                    <a class="btn btn-circle btn-icon-only btn-default" ng-click="toggleEditable()">
                        <span class="glyphicon glyphicon-pencil" ng-show="uneditable" title="Editable"></span>
                        <span class="glyphicon glyphicon-ban-circle" ng-hide="uneditable" title="Uneditable" style="color: red;"></span>
                    </a>
                    <a class="btn btn-circle btn-icon-only btn-default" title="Close" ng-click="togglePortlet()">
                         <span class="glyphicon glyphicon-remove"></span>
                    </a>
                </div>
            </div>
            <div class="portlet-body row" > 
                <!--<div class="appinfo col-sm-4" style="height: 700px;  font-weight: bold; color:#000080; border: 1px solid #ddd;">
                    <h3>Summary: </h3>
                    <p>Template: <br />{{appData.template.name}}</p>
                    <p>Description: <br />{{appData.description}}</p>
                    <p>Number: <br />{{appData.folder}}</p>
                    <p>Upload files: <br />{{appData.NumOfFiles}}</p>
                    <p>Created at: <br />{{appData.createdAt}}</p>
                </div>-->
               
                <div class="panel-group form-panels col-sm-12" id="accordion1" role="tablist" aria-multiselectable="true">
                    <div class="panel panel-primary">
                        <div class="panel-heading" role="tab" id="heading1">
                            <a class="panel-title" onclick="Portlet.togglePanel(this, 0);" data-toggle="collapse" data-parent="#accordion1" aria-expanded="true" aria-controls="collapse1">
                            General</a>
                        </div>
                        <div id="collapse1" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading1">
                            <div class="panel-body">


                                <form class="form-horizontal" role="form" ng-submit="submitTag();" name="genForm">
                                    <div class="form-body" style=""> 

                                        <div class="form-group" ng-class="{'has-error': genForm.sNumber.$touched && genForm.sNumber.$invalid }">
                                            <label for="sNumber" class="col-sm-4" ><span class="form-label bold">Structure Number</span><span class="required">*</span></label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-ssm" name="sNumber" id="sNumber" ng-model="genData.sNumber" placeholder="Structure Number" ng-disabled="uneditable">
                                                <p ng-show="genForm.sNumber.$touched && genForm.sNumber.$invalid" class="help-block">Structure Number is required.</p>
                                            </div>
                                        </div>
                                        <div class="form-group" ng-class="{ 'has-error': genForm.title.$invalid && genForm.title.$touched }">
                                            <label for="title" class="col-sm-4"><span class="form-label bold">Title</span> <span class="required">*</span></label>
                                            <div class="col-sm-8">
                                                <!--<input type="text" class="form-control input-ssm" name="title" id="title" ng-model="genData.title" placeholder="Title" required ng-disabled="uneditable">-->
                                                <textarea class="form-control" rows="3" id="title" name="title" ng-model="genData.title" placeholder="Title" required ng-disabled="uneditable"></textarea>
                                                <p ng-show=" genForm.title.$touched && genForm.title.$invalid" class="help-block">Title is required.</p>
                                            </div>
                                        </div>

                                        <div class="form-group" ng-class="{ 'has-error' : genForm.eCode.$invalid && genForm.eCode.$touched }">
                                             <label for="eCode" class="col-sm-4"><span class="form-label bold">eSubmission Code</span><span class="required">*</span></label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-ssm" name="eCode" id="eCode" ng-model="genData.eCode" placeholder="eSubmission Code" required ng-disabled="uneditable">
                                                <p ng-show="genForm.eCode.$touched && genForm.eCode.$invalid" class="help-block">eSubmission Code is required.</p>
                                            </div>
                                        </div>


                                <!-- drug substance -->

                                        <div class="form-group" ng-class="{ 'has-error': genForm.substance.$invalid && genForm.substance.$touched }" ng-show="substanceTag">
                                            <label for="substance" class="col-sm-4"><span class="form-label bold">Substance</span><span class="required">*</span></label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-ssm" name="substance" id="substance" ng-model="genData.substance" ng-required="substanceTag" ng-disabled="uneditable">
                                                <p ng-show="genForm.substance.$touched && genForm.substance.$invalid" class="help-block">Substance is required.</p>
                                            </div>
                                        </div>

                                        <div class="form-group" ng-class="{ 'has-error' : genForm.manufacturer.$invalid && genForm.manufacturer.$touched }" ng-show="substanceTag">
                                             <label for="manufacturer" class="col-sm-4"><span class="form-label bold">Manufacturer</span><span class="required">*</span></label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-ssm" name="manufacturer" id="manufacturer" ng-model="genData.manufacturer" ng-required="substanceTag" ng-disabled="uneditable">
                                                <p ng-show="genForm.manufacturer.$touched && genForm.manufacturer.$invalid" class="help-block">Manufacturer is required.</p>
                                            </div>
                                        </div>

                                        <div class="form-group" ng-class="{ 'has-error' : genForm.prodName.$invalid && genForm.prodName.$touched }" ng-show="productTag">
                                             <label for="prodName" class="col-sm-4"><span class="form-label bold">Product Name</span><span class="required">*</span></label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-ssm" name="prodName" id="prodName" ng-model="genData.prodName" ng-required="productTag" ng-disabled="uneditable">
                                                <p ng-show="genForm.prodName.$touched && genForm.prodName.$invalid" class="help-block">Product Name is required.</p>
                                            </div>
                                        </div>
                                        <div class="form-group" ng-class="{ 'has-error' : genForm.dosage.$invalid && genForm.dosage.$touched }" ng-show="productTag">
                                             <label for="dosage" class="col-sm-4"><span class="form-label bold">Dosage</span><span class="required">*</span></label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-ssm" name="dosage" id="dosage" ng-model="genData.dosage" ng-required="productTag" ng-disabled="uneditable">
                                                <p ng-show="genForm.dosage.$touched && genForm.dosage.$invalid" class="help-block">Dosage is required.</p>
                                            </div>
                                        </div>

                                        <div class="form-group" ng-class="{ 'has-error' : genForm.manufacturer.$invalid && genForm.manufacturer.$touched }" ng-show="productTag">
                                             <label for="manufacturer" class="col-sm-4"><span class="form-label bold">Manufacturer</span><span class="required">*</span></label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-ssm" name="manufacturer" id="manufacturer" ng-model="genData.manufacturer" ng-required="productTag" ng-disabled="uneditable">
                                                <p ng-show="genForm.manufacturer.$touched && genForm.manufacturer.$invalid" class="help-block">Manufacturer is required.</p>
                                            </div>
                                        </div>

                                        <div class="form-group" ng-show="substanceTag || productTag">
                                             <label for="manual" class="col-sm-4"><span class="form-label">Manual Directory Name</span></label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-ssm" name="manual" id="manual" ng-model="genData.manual" ng-disabled="uneditable">
                                            </div>
                                        </div>

                                <!--   end  substance -->

                                        <div class="form-group" ng-class="{ 'has-error' : genForm.studyNumber.$invalid && genForm.studyNumber.$touched }" ng-show="stfTag">
                                            <label for="studyNumber" class="col-sm-4"><span class="form-label bold">Study Number</span><span class="required">*</span> </label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-ssm" name="studyNumber" id="studyNumber" ng-model="genData.studyNumber" placeholder="<insert ID>" ng-disabled="uneditable" ng-required="stfTag">
                                                <p ng-show=" genForm.studyNumber.$touched && genForm.studyNumber.$invalid" class="help-block">Study Number is required.</p>
                                            </div>
                                        </div>

                                        <div class="form-group"  ng-class="{ 'has-error' : genForm.stfType.$invalid && genForm.stfType.$touched }" ng-show="stfTag">
                                            <label for="stfType" class="col-sm-4"><span class="form-label bold">Study Type</span><span class="required">*</span> </label>
                                            <div class="col-sm-8">
                                                <select class="form-control  input-sm" name="stfType" id="stfType" ng-model="genData.stfType" ng-disabled="uneditable" ng-required="stfTag">
                                                    <option  ng-repeat="x in stfTypes">{{x}}</option>
                                                </select>
                                                <p ng-show=" genForm.stfType.$touched && genForm.stfType.$invalid" class="help-block">Study Type is required.</p>
                                            </div>
                                        </div>
                                        <div class="form-group" ng-show="stfTag">
                                            <label for="species" class="col-sm-4"><span class="form-label">Species</span> </label>
                                            <div class="col-sm-8">
                                                <select multiple class="form-control  input-sm" name="species" id="species" ng-model="genData.species" ng-disabled="uneditable">
                                                    <option  ng-repeat="x in specieTypes">{{x}}</option>
                                                </select>

                                            </div>
                                        </div>
                                        <div class="form-group row" ng-show="stfTag">
                                            <label for="route" class="col-sm-4"><span class="form-label">Route of Admin</span></label>
                                            <div class="col-sm-8">
                                                <select class="form-control  input-sm" name="route" id="route" ng-model="genData.route" ng-disabled="uneditable">
                                                    <option  ng-repeat="x in routeTypes">{{x}}</option>
                                                </select>

                                            </div>
                                        </div>

                                        <div class="form-group" ng-show="stfTag">
                                            <label for="duration" class="col-sm-4"><span class="form-label">Duration</span> </label>
                                            <div class="col-sm-8">
                                                <select class="form-control  input-sm" name="duration" id="duration" ng-model="genData.duration" ng-disabled="uneditable">
                                                    <option  ng-repeat="x in durationTypes">{{x}}</option>
                                                </select>
                                            </div>
                                        </div>  
                                         <div class="form-group" ng-show="stfTag">
                                            <label for="control" class="col-sm-4"><span class="form-label">Type of Control</span> </label>
                                            <div class="col-sm-8">
                                                <select class="form-control  input-sm" name="control" id="control" ng-model="genData.control" ng-disabled="uneditable">
                                                    <option  ng-repeat="x in controlTypes">{{x}}</option>
                                                </select>
                                            </div>
                                        </div>  

                                        <div class="form-actions">
                                            <div class="col-md-offset-2 col-md-10">
                                                    <button type="submit" class="btn green" ng-disabled="genForm.$invalid || uneditable">Save</button>
                                                    <button type="button" class="btn default" ng-disabled="uneditable" ng-click="cancelTag()">Cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>


                            </div>
                        </div>
                    </div>
                    <div class="panel panel-primary">
                        <div class="panel-heading" role="tab" id="heading2">
                            <a class="panel-title" onclick="Portlet.togglePanel(this, 1);" data-toggle="collapse" data-parent="#accordion1" aria-expanded="false" aria-controls="collapse2">
                            Configuration</a>
                        </div>
                         <div id="collapse2" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading2">
                             <div class="panel-body">


                        <div class="form-group">
                            <label for="media" class="col-sm-4"><span class="form-label">Output Media</span> </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control input-ssm" name="media" id="media" ng-model="congigData.media" ng-disabled="uneditable">
                            </div>
                        </div>   
                        <div class="form-group">
                            <div class="col-sm-offset-4 col-sm-8">
                                <label class="form-check-label"><input type="checkbox" name="sourcefile" id="sourcefile" ng-model="configData.sourcefile" />&nbsp;&nbsp;Publish source file unchange</label><br />
                                <label class="form-check-label"><input type="checkbox" name="bookmarks" id="bookmarks" ng-model="configData.bookmarks" />&nbsp;&nbsp;Publish PDF bookmarks</label>   <br />
                                <label class="form-check-label"><input type="checkbox" name="singleDoc" id="singleDoc" ng-model="configData.singleDoc" />&nbsp;&nbsp;Publish as Single Document</label><br />
                                <label class="form-check-label"><input type="checkbox" name="noNodes" id="noNodes" ng-model="configData.noNodes" />&nbsp;&nbsp;Do not publish nodes as bookmarks</label><br />
                                <label class="form-check-label"><input  type="checkbox" name="subnodes" id="subnodes" ng-model="configData.subnodes" />&nbsp;&nbsp;Allow subnodes</label>
                            </div>
                        </div>  
                        <div class="form-group">
                            <label for="contOption" class="col-sm-4"><span class="form-label">Content Option</span> </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control input-ssm" name="contOption" id="contOption" ng-model="configData.contOption"  ng-disabled="uneditable">
                            </div>
                        </div>  


                             </div>
                         </div>
                    </div>

                    <div class="panel panel-primary">
                        <div class="panel-heading" role="tab" id="heading3">
                            <a class="panel-title" onclick="Portlet.togglePanel(this, 2);" data-toggle="collapse" data-parent="#accordion1" aria-expanded="false" aria-controls="collapse3">
                            Header and Footer</a>
                        </div> 
                         <div id="collapse3" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading3">
                            <div class="panel-body">
                                <div class="form-group">
                                <div class="col-sm-offset-4 col-sm-8">
                                    <label class="form-check-label"><input type="checkbox" name="noHeadFoot" id="noHeadFoot" ng-model="headerData.noHeadFoot" />&nbsp;&nbsp;No header or footer</label><br />
                                    <label class="form-check-label"><input type="checkbox" name="headFoot" id="headFoot" ng-model="headerData.headFoot" />&nbsp;&nbsp;Section header and footer</label>
                                </div>
                                </div> 

                            </div>
                        </div>
                    </div>
                </div>
                </div>
            
        </div>
        <!-- END: ACCORDION DEMO -->
    </div>
    
</div>
<!-- END MAIN CONTENT -->
<!-- BEGIN MAIN JS-->
<!--<script src="dist/jsECTDtree.js"></script>
<script src="dist/Filetree.js"></script>-->
<script src="dist/InfoFiletree.js"></script>
<script>
    function togglePanel(){
        var leftPanel = $(".leftPanel");
        var rightPanel = $(".rightPanel");
        if(leftPanel.hasClass("col-md-4")){
            leftPanel.removeClass("col-md-4").addClass("col-md-6");
            rightPanel.removeClass("col-md-8").addClass("col-md-6");
            rightPanel.find("#TagCtrl").css({"width": "100%"});
        }else {
            leftPanel.removeClass("col-md-6").addClass("col-md-4");
            rightPanel.removeClass("col-md-6").addClass("col-md-8");
            rightPanel.find("#TagCtrl").css({"width": "60%"});
        }
    }
</script>
<!--<script>
    function Jstree(id, height){
        this.tree = $(id); 
        this.height = height;
        this.ctrlId = "#AdinfoCtrl";
    }
    Jstree.prototype = {
        constructor: Jstree,
        setHandler: function(){
            var _this = this;
            this.tree.jstree(true).bind("select_node.jstree", function (e, data) { 
                _this.tree.jstree(true).getNodeContent(data.node);                                      //console.log("node_id: " + data.node.id); 
            });
        },
        getSelectedNode: function(){
            var node = this.tree.jstree(true).get_selected(true);
            return node.length ? node[0] : false;
        },
        addNodeText:function(id, text){
            //var node = $('#jsECTDtree').find("[id="+id+"]"); console.log(node); 
            var node = this.tree.jstree(true).get_node(id); console.log(node);
            this.tree.jstree(true).set_text(node, node.text+' '+text);
        }, 
        getNodeContent: function(selectedNode){           
            if(selectedNode){
                var node = selectedNode;
                angular.element("#TagCtrl").scope().setTagTitle(node, true);
            }else{
                var node = this.getSelectedNode();                        //console.log(node);
                if(node) angular.element("#TagCtrl").scope().setTagTitle(node, false);
            }
        }
    }
    Jstree.prototype.__proto__ = Filetree.prototype;
    var JsTree = new Jstree("#jsECTDtree", $(window).height()-250 );

    JsTree.setSelectNodeHandler(function(data){
            JsTree.getNodeContent(data.node);                                      //console.log("node_id: " + data.node.id); 
        });
</script>
<script>
    function JstreeCtrl($rootScope, $scope, $state, $cookies, ApplicationApiService){ 
        var appUid;
        $rootScope.userData = JSON.parse($cookies.get('globals'));
        if($cookies.get("appData")) {
            $rootScope.appData = JSON.parse($cookies.get("appData"));
            appUid = $rootScope.appData.appUid;                                       //console.log("appUid", appUid)
        }else {
            $state.go("submission");
            $translate("WARNING_NOAPP").then(function(translation){
                toastr.warning(translation);
            })
        }
        
        if(!$rootScope.subFiles || $rootScope.subFiles.length==0){
            ApplicationApiService.GetApplication(appUid, $rootScope.userData).then(function(result){                   
                $rootScope.subFiles = result.nodeList;
                JsTree.initTree($rootScope.subFiles);                               //console.log('subFiles: ', $rootScope.subFiles); 
            });
        }else{             
            JsTree.initTree($rootScope.subFiles);                               //console.log('subFiles: ', $rootScope.subFiles);  
        }
        $scope.toggleTree = function(){
            JsTree.toggle($rootScope.open);
            $rootScope.open = ! $rootScope.open; // ? false : true;
        };
        $rootScope.togglePortlet = function(){
            JsTree.getNodeContent();
            $rootScope.tagEdit = true;
            //var node = JsTree.getSelectedNode();  
            //if(node) angular.element('#TagCtrl').scope().setTagTitle(node.original.sNumber, node.text, false);
        };
     }
    function AdinfoCtrl($rootScope, $scope, $state, $cookies, $translate, GenInfoApiService){  //console.log($rootScope.subFiles);
        
        var appUid = $rootScope.appData.appUid;
        
        $scope.getUserData = function(){
            return $rootScope.userData;
        };
        var adminData ={};           // = $cookies.get("adminData")? JSON.parse($cookies.get("adminData")):{};
        GenInfoApiService.GetGenInfo(appUid, $rootScope.userData).then(
                function(result){ 
                    if(result && result.id){
                        adminData = result;                      
                    }                          
                    $scope.adminData = angular.copy(adminData);
        });
        var contacts = [], contact={};
        GenInfoApiService.GetContacts(appUid, $rootScope.userData).then(
                function(result){                                               //console.log("contact data: ", result);
                    if(result){ contacts = result; 
                        contact = contacts[0];
                    } 
                    $scope.contactData = angular.copy(contact); 
                });
        /*if($cookies.get("contactData")) {
            contacts = JSON.parse($cookies.get("contactData"));
            contact = contacts[0];
        };*/
        var referenceData={};
        $scope.contactTypes = ["Regulatory Contact", "Technical Contact", "United States Agent", "Promotional Labelling and Advertising Regulatory Contact"];
        $scope.appTypes = ["New Drug application (NDA)", "abbreviated new drug application (ANDA)","Biologic License Application (BLA)", "Investigational New Drug (IND)",
                "Drug Master File (DMF)", "Emergency Use Authorization (EUA)"];
        $scope.subTypes =["Original Application", "Efficacy Supplement", "Chemistry Manufacturing Controls Supplement","Labeling Supplement", "Annual Report", "Product Correspondence",
                "Postmarketing Requirements or Postmarketing Commitments", "Promotional Labeling Advertising", "IND Safety Reports", "Periodic Safety Reports"];
        $scope.effTypes =["Prior Approval Supplement (PAS)", "Changes Being Effected-0 (CBE-0)", "Changes Being Effected-30 (CBE-30)"];
        $scope.subSubTypes = ["Original", "Presubmisssion", "Application", "Amendment", "Resubmission", "Report", "Correspondence"];
        
      
        //$scope.adminData = angular.copy(adminData);
        //$scope.contactData = angular.copy(contact);                         //console.log("initial contact", contacts[0]);
        $scope.referenceData = angular.copy(referenceData);
        
        $scope.toggleEditable = function(){
            $scope.uneditable =!$scope.uneditable;
        };
        
        $scope.submitAdinfo = function(){                                       
            
            if($scope.adminForm.$valid){
                if($scope.adminData.createdAt) {
                    delete $scope.adminData.createdAt; 
                    delete $scope.adminData.updatedAt; 
                }
                var jsonData =JSON.stringify( $scope.adminData);                                 console.log("submit admin", jsonData);
                GenInfoApiService.CreateGenInfo(appUid, userData, jsonData).then(function(result){
                    if(result.id){
                        toastr.success('Admin info Saved');
                        $scope.uneditable = true;
                    }
                });
                /*$.post('php/adinfo.php', {'appData': jsonData}, function(result){
                    if(result) {
                        toastr.success('Admin info Saved');
                        $cookies.putObject("adminData",$scope.adminData);
                    }
                });*/
            }   
        };
        $scope.cancelAdinfo = function(){                                              //console.log(jsonx);
            $scope.adminData = angular.copy(adminData);
            $scope.adminForm.$setPristine();
            $scope.adminForm.$setUntouched();
            $scope.adminForm.$setValidity();
        }; 
        $scope.submitContact = function(){ 
            //if(!$scope.isStringNumberic($scope.contactForm.phone.$viewValue)) return;
            //$scope.contactData.appUid = appUid;                                        console.log(JSON.stringify($scope.contactData));
            if($scope.contactForm.$valid){
                if($scope.contactData.createdAt) {
                    delete $scope.contactData.createdAt; 
                    delete $scope.contactData.updatedAt; 
                }
                var jsonData =JSON.stringify($scope.contactData);               console.log("contact data: ", jsonData);                  
                                                                       
                GenInfoApiService.CreateContact(appUid, userData, jsonData).then(
                        function(result){                                       console.log(result);
                            if(result && result.id) contact = result;
                            $scope.uneditable = true;
                            updateContact(contact);
                });
                
            }   
        };
        $scope.cancelContact = function(){                                          //console.log(contact);
            $scope.contactData = angular.copy(contact);
            $scope.contactForm.$setPristine();
            $scope.contactForm.$setUntouched();
            $scope.contactForm.$setValidity();
        };
        $scope.updateContact = function(){                                      
            if(contacts.length>=1){                                             //console.log(contacts);
                contact = {"contactType": $scope.contactForm.contactType.$viewValue};
                for(var i=0; i<contacts.length; i++ ){                          //console.log(contacts[i].contactType);               
                    if(contacts[i].contactType == $scope.contactForm.contactType.$viewValue) {contact = contacts[i];}
                }; 
                $scope.contactData = angular.copy(contact);
            }
            //$scope.contactForm.$setPristine();
            $scope.contactForm.$setUntouched();
            //$scope.contactForm.$setValidity();
        };
        function updateContact(newContact){
            var found = false; 
            for(var i=0; i<contacts.length; i++ ){                          //console.log(contacts[i].contactType);               
                if(contacts[i].contactType == newContact.contactType) {contacts[i] = newContact; found = true; } 
            };
            if(!found) contacts.push(newContact);
        }
        $scope.submitReference = function(){
            if($scope.referenceForm.$valid){
                var jsonData =JSON.stringify( $scope.referenceData);                                 //console.log(jsonData);
                $.post('php/adinfo.php', {'appData': jsonData}, function(result){
                    if(result) {
                        toastr.success('Reference information Saved');
                        //$scope.uneditable = true;
                        //Portlet.write(result);
                    }
                });
            }   
        };
        $scope.cancelReference = function(){
            $scope.referenceData = angular.copy(contactData);
            $scope.referenceForm.$setPristine();
            $scope.referenceForm.$setUntouched();
            $scope.referenceForm.$setValidity();
        };
        
    }
    function TagCtrl($rootScope, $scope, $state, $cookies, TagApiService){
        var appData, appUid;
        if($cookies.get("appData")) {
            appData = JSON.parse($cookies.get("appData"));
            appUid = appData.appUid;
            //$scope.appCreated = true; 
        }else {
            $state.go("submission");
            $translate("WARNING_NOAPP").then(function(translation){
                toastr.warning(translation);
            })
            //toastr.warning("You need to create an application to edit Aministration information!");
        }
        var userData = JSON.parse($cookies.get('globals'));
        var tagData=[], jsonx= {}, nodeId;
        /*if($cookies.get("tagData")) {
            tagData = JSON.parse($cookies.get("tagData"));                      console.log(tagData);
        };*/
        
        $scope.stfTypes = ["Pre-clinical study report", "Complete clinical study report", "2 Study Report Synopsis", "1,3-15 Study Report Body", "16.1.1 Protocol and/or Amendment", 
                "16.1.2 Sample CRF", "16.1.3 IEC and IRB and Consent Form Listings", "16.1.4 Description of Investigators and Sites", 
                "16.1.5 Signatures of principal or coordinating investigator(s)or sponsor's reponsible medical officer", "16.1.6 Listing of patients receiving test drug(s) from specified batch",
                "16.1.7 Randomisation Scheme","16.1.8 Audit Certificates or similar documentation", "16.1.9 Documentation of statistical methods and interim analysisis plans", 
                "16.1.10 Documentation of Inter-laboratory Standardization and Quality Assurance" ] ;
        $scope.specieTypes = ["none", "mouse", "rat", "hamster", "other-rodent", "rabbit", "dog", "non-human-primate", "other-non-rodent-mammal", "non-mammals"];
        $scope.routeTypes = ["none", "oral", "intravenous", "intramuscular", "intraperitioneal", "subcutaneous", "inhalation", "topical", "other"];
        $scope.durationTypes = ["none", "short", "medium", "long"];
        $scope.controlTypes = ["none", "placebo", "no-treatment", "dose-reponse-without-placebo", "active-control-without-placebo", "external"];
        
        $scope.init = function(){
            $scope.uneditable = true; 
            $scope.substanceTag = false;
            $scope.productTag = false;
            $scope.stfTag = false;
        };
        $scope.genData = angular.copy(jsonx);
        $scope.toggleEditable = function(){
            $scope.uneditable = !$scope.uneditable;
        };
        $scope.togglePortlet = function(){
            //Portlet.toggle('admin');
            $rootScope.tagEdit = false;
        };
        
        $scope.submitTag = function(){                                          
            if($scope.genForm.$valid){                                          
                $scope.genData.nodeId = nodeId;
                $scope.genData.species = "";
                if($scope.genData.createdAt){
                    delete $scope.genData.createdAt;
                    delete $scope.genData.updatedAt;
                }
                $scope.genData.tag = $scope.substanceTag? "substance" : $scope.productTag? "product" : $scope.stfTag ? "stf" : null; 
                var genData = JSON.stringify($scope.genData);                                  console.log("tag: " , $scope.genData);
                
                TagApiService.CreateTag(userData, appUid, genData).then(function(result){           console.log(result)
                     if(result.id){
                        toastr.success('Tag info');
                        if($scope.genData.nodeId=="m32s"||$scope.genData.nodeId=="m23S"){ 
                            var addText = "["+$scope.genData.manufacturer+"]["+$scope.genData.substance+"]";
                            JsTree.addNodeText($scope.genData.nodeId, addText);
                        }else if($scope.genData.nodeId=="m32p"||$scope.genData.nodeId=="m23P"){
                            var addText = "["+$scope.genData.manufacturer+"]["+$scope.genData.prodName+"]["+$scope.genData.dosage+"]";
                            JsTree.addNodeText($scope.genData.nodeId, addText);
                        }
                     }
                });
                /*$.post('php/tag.php', {'appData': genData}, function(result){
                    if(result) {
                        toastr.success('Tag info');
                        //Portlet.write(result, true);                                       
                        
                        if($scope.genData.nodeId=="m32s"||$scope.genData.nodeId=="m23S"){ 
                            var addText = "["+$scope.genData.manufacturer+"]["+$scope.genData.substance+"]";
                            JsTree.addNodeText($scope.genData.nodeId, addText);
                        }else if($scope.genData.nodeId=="m32p"||$scope.genData.nodeId=="m23P"){
                            var addText = "["+$scope.genData.manufacturer+"]["+$scope.genData.prodName+"]["+$scope.genData.dosage+"]";
                            JsTree.addNodeText($scope.genData.nodeId, addText);
                        }
                        
                        var findTag = false;
                        if(tagData.length>=1){
                            for(var i=0; i<tagData.length; i++ ){                                         
                                if(tagData[i].nodeId == nodeId){                    //console.log(tagData[i].nodeId, nodeId);
                                    tagData[i]=angular.copy($scope.genData);
                                    findTag = true;
                                }
                            }
                        }
                        if(!findTag) tagData.push(angular.copy($scope.genData));
                        $cookies.putObject("tagData", tagData);
                    }
                });*/
                $scope.uneditable = true; 
                //toastr.success('Stf done');
            }   
        };
        $scope.cancelTag = function(){
            $scope.genData = angular.copy(jsonx);
            $scope.genForm.$setPristine();
            $scope.genForm.$setUntouched();
            $scope.genForm.$setValidity();
        };
        $scope.setTagTitle = function(node, edit){                                 //console.log(node);
           
            var sNumber =node.type=="tag"? node.text.split(" ")[0] : node.original.sNumber;
            nodeId = node.id;                                                                  //console.log('id',nodeId)
            var studyTag = showTags(node);
            var findTag = false;
            /*if(tagData.length>=1){
                for(var i=0; i<tagData.length; i++){
                    if(tagData[i].nodeId == nodeId){ 
                        jsonx = tagData[i]; findTag = true;
                    }
                }
            }*/
            
            TagApiService.GetTagByNid(appUid, nodeId, userData).then(function(result){    //console.log("tag:", result);
                if(result && result.id){
                    jsonx = result;                                             console.log("result: ", jsonx);
                    $scope.genData = angular.copy(jsonx);
                }else{
                    var title = node.text.slice(node.text.indexOf(" ")+1, node.text.length);
                    jsonx = studyTag? {"title": "Study Title", "eCode":"Study Report (STF 2.2)"} : {'sNumber': sNumber, 'title': title, 'eCode':node.text};
                     $scope.genData = angular.copy(jsonx);
                }
                
            });
            
            /*var title = node.text.slice(node.text.indexOf(" ")+1, node.text.length);
            if(!findTag) jsonx = studyTag? {"title": "Study Title", "eCode":"Study Report (STF 2.2)"} : {'sNumber': sNumber, 'title': title, 'eCode':node.text};
            if(edit)
                $scope.$apply(function(){
                        $scope.genData = angular.copy(jsonx); 
                    });
            else{
                $scope.genData = angular.copy(jsonx);;
            } */
           
       };
       function showTags(node){
           
           if(node.id==="m32S"||node.id==="m23S"){
                $scope.substanceTag = true;
                $scope.productTag = false;
                $scope.stfTag = false;
           }else if(node.id==="m32P"||node.id==="m23P"){
                $scope.productTag = true; 
                $scope.stfTag = false;
                $scope.substanceTag = false;
           }else if(node.type==="file" && node.parents.includes("m4")){
                $scope.substanceTag = false;
                $scope.productTag = false;
                $scope.stfTag = true;
                return true;
                //$scope.genData.eCode = "Study Report (STF 2.2)";
           }else{
                $scope.substanceTag = false;
                $scope.productTag = false;
                $scope.stfTag = false;
           }
         
       }
    }
    var Portlet = function(){
        return{
            write: function(data, tag){
                if(tag) $('.tag-portlet').find('.portlet-body').html(data);
                else $('.admin-portlet').find('.portlet-body').html(data);
            },
            togglePanel: function(el, x){                                          //console.log($(el))
                var accordin = $(el).parents(".form-panels");
                accordin.find(".panel").each(function(index){                    
                    //$(this).find(".panel-collapse.collapse").collapse("toggle");
                    var title = $(this).find("a.panel-title");
                    if(index===x){                                     //console.log(title.attr("aria-expanded"))                                  
                        if(title.attr("aria-expanded")==="true"){ 
                            title.attr("aria-expanded", "false");
                            $(this).find(".panel-collapse.collapse").collapse('hide');
                        }else{
                            title.attr("aria-expanded", "true");
                            $(this).find(".panel-collapse.collapse").collapse('show');
                        }
                    }else{
                        title.attr("aria-expanded", "false");
                        $(this).find(".panel-collapse.collapse").collapse('hide');
                    } 
                });
            }
        };
    }();
</script>-->
<!--<script>
    var JsTree = function (){

         function dblclickEventHandler(event){
            var nodeId = $(event.target).closest("li")[0].id;
            var node = $('#jsECTDtree').jstree(true).get_node(nodeId);             //console.log(node); 
            if(node && node.type=="file"){ 
                var uuid = node.id;                                   
                var userData = angular.element("#AdinfoCtrl").scope().getUserData();  //console.log("UUID: ",uuid, userData );
                
                //var portlet = $("div.admin-portlet");
                //var url = 'http://192.168.88.187:8080/ectd' + "/a/application/file/download/" + uuid +"/?uid=" + userData.uid +"&apptoken=" + userData.access_token;
                var url = Base_URL + "/a/application/file/download/" + uuid +"/?uid=" + userData.uid +"&apptoken=" + userData.access_token;
                //openFrame(portlet, $(".jstree-portlet").height(), url);
                openIframe(url);
            }
        }
        return {
            initTree: function(json){
                $('#jsECTDtree').jstree({
                    "core" : {
                        //"animation" : 0,
                        "multiple": false,
                        "check_callback" : false,
                        "themes" : { "stripes" : true },
                        "data" : json
                    },
                    "types" : { "#" : {"max_children" : 8, "max_depth" :8, "valid_children" : ["root"]},
                        "root" : { "icon" : "assets/tree_icon.png","valid_children" : ["default"] },
                        "default" : {"valid_children" : ["folder", "file"]},
                        "folder": {"valid_children" : ["folder","file"]},
                        "tag": {"icon" : "fa fa-file-o", "valid_children" : ["file"]},
                        "file" : { "icon" : "glyphicon glyphicon-file", "valid_children" : []} 
                    },
                    "plugins" : ["types", "state"]
                    /*'contextmenu' : {
                        'items' : customMenu, select_node : true
                    }*/
                }).bind("hover_node.jstree", function(event, data){                            //console.log(data);
                    $("#"+data.node.id).prop("title", data.node.text);
                }).bind("loaded.jstree", function (event, data) {
                    $(this).css("height", $(window).height()-250);              //alert($(this).width());
                    var $tree = $(this);
                    $($tree.jstree().get_json("#", {flat: true}))
                        .each(function(index, value) {
                              var node = $tree.jstree().get_node(this.id);
                              if(node.type === "tag" && node.children.length) 
                                  $tree.jstree().set_icon(node.id, "glyphicon glyphicon-file");
                        });
                    App.initSlimScroll("#jsECTDtree");
                }).bind("select_node.jstree", function (e, data) { 
                    JsTree.getNodeContent(data.node);                                      //console.log("node_id: " + data.node.id); 
                }).bind("dblclick.jstree", function(event){
                    dblclickEventHandler(event);
                });
            },
           toggle: function(open){
                if (open)
                    $('#jsECTDtree').jstree().close_node(["m1", "m2", "m3", "m4", "m5"]); 
                else
                    $('#jsECTDtree').jstree("open_all");
            },
            getSelectedNode: function(){
                var node = $('#jsECTDtree').jstree(true).get_selected(true);
                return node.length ? node[0] : false;
            },
            addNodeText:function(id, text){
                //var node = $('#jsECTDtree').find("[id="+id+"]"); console.log(node); 
                var node = $('#jsECTDtree').jstree(true).get_node(id); console.log(node);
                $('#jsECTDtree').jstree(true).set_text(node, node.text+' '+text);
            }, 
            getNodeContent: function(selectedNode){
                if(selectedNode){
                    var node = selectedNode;
                    angular.element("#TagCtrl").scope().setTagTitle(node, true);
                }else{
                    var node = JsTree.getSelectedNode();                        //console.log(node);
                    if(node) angular.element("#TagCtrl").scope().setTagTitle(node, false);
                }
            }
        };   
    }();
    //App.initSlimScroll('.scroller');
</script>-->
